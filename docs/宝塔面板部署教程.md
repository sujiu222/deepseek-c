# å®å¡”é¢æ¿ + Docker éƒ¨ç½²æ•™ç¨‹

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. æœåŠ¡å™¨è¦æ±‚

- æ“ä½œç³»ç»Ÿï¼šCentOS 7+ã€Ubuntu 18.04+ã€Debian 9+
- å†…å­˜ï¼šâ‰¥ 2GB
- CPUï¼šâ‰¥ 1 æ ¸
- ç¡¬ç›˜ï¼šâ‰¥ 20GB

### 2. å®‰è£…å®å¡”é¢æ¿

```bash
# CentOS
yum install -y wget && wget -O install.sh https://download.bt.cn/install/install_6.0.sh && sh install.sh

# Ubuntu/Debian
wget -O install.sh https://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh
```

å®‰è£…å®Œæˆåè®°å½•ï¼š

- é¢æ¿åœ°å€ï¼š`http://your-ip:8888`
- ç”¨æˆ·å
- å¯†ç 

---

## ğŸ”§ ç¬¬ä¸€æ­¥ï¼šå®‰è£…å¿…è¦è½¯ä»¶

### 1. ç™»å½•å®å¡”é¢æ¿

è®¿é—® `http://your-ip:8888`ï¼Œä½¿ç”¨å®‰è£…æ—¶çš„ç”¨æˆ·åå¯†ç ç™»å½•ã€‚

### 2. å®‰è£…è½¯ä»¶ï¼ˆåœ¨"è½¯ä»¶å•†åº—"ä¸­ï¼‰

#### å¿…è£…ï¼š

- âœ… **Docker** - å®¹å™¨ç®¡ç†
- âœ… **PostgreSQL 15** - æ•°æ®åº“

#### å¯é€‰ï¼š

- âœ… **Nginx** - åå‘ä»£ç†ï¼ˆé€šå¸¸å·²å®‰è£…ï¼‰
- âœ… **Docker Compose** - å®¹å™¨ç¼–æ’

---

## ğŸ—„ï¸ ç¬¬äºŒæ­¥ï¼šé…ç½®æ•°æ®åº“

### 1. åˆ›å»ºæ•°æ®åº“

**å®å¡”é¢æ¿ â†’ æ•°æ®åº“ â†’ PostgreSQL â†’ æ·»åŠ æ•°æ®åº“**

- æ•°æ®åº“åï¼š`deepseek-c`
- ç”¨æˆ·åï¼š`deepseek_user`
- å¯†ç ï¼š`ç”Ÿæˆå¼ºå¯†ç `ï¼ˆè®°å½•ä¸‹æ¥ï¼‰

### 2. æˆ–è€…ä½¿ç”¨ç»ˆç«¯åˆ›å»º

```bash
# è¿›å…¥ PostgreSQL
sudo -u postgres psql

# æ‰§è¡Œ SQL
CREATE DATABASE "deepseek-c";
CREATE USER deepseek_user WITH PASSWORD 'your_strong_password';
GRANT ALL PRIVILEGES ON DATABASE "deepseek-c" TO deepseek_user;
\q
```

---

## ğŸ“¦ ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²åº”ç”¨

### 1. åˆ›å»ºé¡¹ç›®ç›®å½•

**å®å¡”é¢æ¿ â†’ æ–‡ä»¶ â†’ /www/wwwroot â†’ æ–°å»ºç›®å½•**

- ç›®å½•åï¼š`deepseek-c`

æˆ–ä½¿ç”¨ç»ˆç«¯ï¼š

```bash
cd /www/wwwroot
mkdir deepseek-c
cd deepseek-c
```

### 2. ä¸Šä¼ ä»£ç 

#### æ–¹å¼ Aï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰

```bash
cd /www/wwwroot/deepseek-c
git clone https://github.com/sujiu222/deepseek-c.git .
```

#### æ–¹å¼ Bï¼šæ‰‹åŠ¨ä¸Šä¼ 

åœ¨å®å¡”é¢æ¿ â†’ æ–‡ä»¶ â†’ ä¸Šä¼ æ–‡ä»¶ï¼Œå°†é¡¹ç›®å‹ç¼©åŒ…ä¸Šä¼ å¹¶è§£å‹ã€‚

### 3. åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®

```bash
cd /www/wwwroot/deepseek-c
cp .env.example .env.production
nano .env.production
```

ç¼–è¾‘ `.env.production`ï¼š

```bash
# DeepSeek API é…ç½®
DEEPSEEK_RPC_URL=https://api.chatanywhere.tech
DEEPSEEK_API_KEY=sk-your-production-api-key

# æ•°æ®åº“é…ç½®
# æ³¨æ„ï¼šDocker å®¹å™¨è®¿é—®å®¿ä¸»æœºä½¿ç”¨ host.docker.internal
DATABASE_URL=postgresql://deepseek_user:your_strong_password@host.docker.internal:5432/deepseek-c

# è®¤è¯é…ç½®
NEXTAUTH_URL=https://your-domain.com
NEXTAUTH_SECRET=$(openssl rand -base64 32)

NODE_ENV=production
```

ä¿å­˜å¹¶é€€å‡ºï¼ˆCtrl + Xï¼Œç„¶å Yï¼Œç„¶å Enterï¼‰

### 4. æ„å»º Docker é•œåƒ

```bash
cd /www/wwwroot/deepseek-c
docker build -t deepseek-c .
```

**ç­‰å¾… 1-3 åˆ†é’Ÿ**ï¼Œçœ‹åˆ° `Successfully built` å’Œ `Successfully tagged deepseek-c:latest` è¡¨ç¤ºæˆåŠŸã€‚

### 5. å¯åŠ¨å®¹å™¨

#### ä½¿ç”¨ docker-composeï¼ˆæ¨èï¼‰

```bash
docker-compose up -d
```

#### æˆ–ä½¿ç”¨ docker run

```bash
docker run -d \
  --name deepseek-c \
  -p 3000:3000 \
  --env-file .env.production \
  --add-host host.docker.internal:host-gateway \
  --restart unless-stopped \
  deepseek-c
```

### 6. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
docker exec -it deepseek-c npx prisma migrate deploy
```

### 7. éªŒè¯è¿è¡ŒçŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹æ—¥å¿—
docker logs -f deepseek-c
```

çœ‹åˆ° `ready started server on 0.0.0.0:3000` è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼

---

## ğŸŒ ç¬¬å››æ­¥ï¼šé…ç½® Nginx åå‘ä»£ç†

### æ–¹å¼ 1ï¼šå®å¡”é¢æ¿å›¾å½¢åŒ–é…ç½®ï¼ˆæ¨èæ–°æ‰‹ï¼‰

#### 1. æ·»åŠ ç½‘ç«™

**å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ æ·»åŠ ç«™ç‚¹**

- åŸŸåï¼š`your-domain.com`
- å¤‡æ³¨ï¼š`deepseek-c`
- æ ¹ç›®å½•ï¼š`/www/wwwroot/deepseek-c`ï¼ˆéšæ„ï¼Œä¸ä¼šç”¨åˆ°ï¼‰
- PHP ç‰ˆæœ¬ï¼š`çº¯é™æ€`

ç‚¹å‡»"æäº¤"

#### 2. é…ç½®åå‘ä»£ç†

**ç½‘ç«™è®¾ç½®ï¼ˆç‚¹å‡»åŸŸååçš„"è®¾ç½®"ï¼‰â†’ åå‘ä»£ç† â†’ æ·»åŠ åå‘ä»£ç†**

- ä»£ç†åç§°ï¼š`deepseek-c`
- ç›®æ ‡ URLï¼š`http://127.0.0.1:3000`
- å‘é€åŸŸåï¼š`$host`
- å†…å®¹æ›¿æ¢ï¼šç•™ç©º

ç‚¹å‡»"æäº¤"

#### 3. ç”³è¯· SSL è¯ä¹¦

**ç½‘ç«™è®¾ç½® â†’ SSL â†’ Let's Encrypt**

- åŸŸåï¼šå‹¾é€‰ä½ çš„åŸŸå
- éªŒè¯æ–¹å¼ï¼šæ–‡ä»¶éªŒè¯
- å‹¾é€‰"å¼ºåˆ¶ HTTPS"

ç‚¹å‡»"ç”³è¯·"ï¼Œç­‰å¾…å‡ ç§’é’Ÿå³å¯ã€‚

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆæ¨èé«˜çº§ç”¨æˆ·ï¼‰

**ç½‘ç«™è®¾ç½® â†’ é…ç½®æ–‡ä»¶**

å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSL è¯ä¹¦è·¯å¾„ï¼ˆLet's Encrypt è‡ªåŠ¨ç”Ÿæˆï¼‰
    ssl_certificate /www/server/panel/vhost/cert/your-domain.com/fullchain.pem;
    ssl_certificate_key /www/server/panel/vhost/cert/your-domain.com/privkey.pem;

    # SSL é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;

    # å®‰å…¨å¤´
    add_header Strict-Transport-Security "max-age=31536000" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    access_log /www/wwwlogs/deepseek-c.log;
    error_log /www/wwwlogs/deepseek-c.error.log;
}
```

ä¿å­˜å¹¶é‡è½½ Nginxã€‚

---

## âœ… ç¬¬äº”æ­¥ï¼šè®¿é—®æµ‹è¯•

1. æµè§ˆå™¨è®¿é—®ï¼š`https://your-domain.com`
2. åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢
3. æ³¨å†Œè´¦å·å¹¶æµ‹è¯•èŠå¤©åŠŸèƒ½

---

## ğŸ”„ å¸¸ç”¨ç»´æŠ¤å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—

```bash
# åº”ç”¨æ—¥å¿—
docker logs -f deepseek-c

# Nginx è®¿é—®æ—¥å¿—
tail -f /www/wwwlogs/deepseek-c.log

# Nginx é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/deepseek-c.error.log
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯å®¹å™¨
docker restart deepseek-c

# é‡å¯ Nginxï¼ˆå®å¡”é¢æ¿ â†’ è½¯ä»¶å•†åº— â†’ Nginx â†’ é‡å¯ï¼‰
# æˆ–å‘½ä»¤è¡Œ
systemctl restart nginx
```

### æ›´æ–°ä»£ç 

```bash
cd /www/wwwroot/deepseek-c
git pull origin main
docker-compose down
docker-compose up -d --build
docker exec -it deepseek-c npx prisma migrate deploy
```

### æŸ¥çœ‹èµ„æºä½¿ç”¨

```bash
# Docker å®¹å™¨èµ„æº
docker stats deepseek-c

# ç³»ç»Ÿèµ„æºï¼ˆå®å¡”é¢æ¿é¦–é¡µå¯ä»¥çœ‹åˆ°ï¼‰
htop
```

### å¤‡ä»½æ•°æ®åº“

**å®å¡”é¢æ¿ â†’ æ•°æ®åº“ â†’ PostgreSQL â†’ deepseek-c â†’ å¤‡ä»½**

æˆ–å‘½ä»¤è¡Œï¼š

```bash
# å¤‡ä»½
pg_dump -U deepseek_user deepseek-c > backup_$(date +%Y%m%d).sql

# æ¢å¤
psql -U deepseek_user deepseek-c < backup_20250102.sql
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### 1. å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker logs deepseek-c

# å¸¸è§é—®é¢˜ï¼š
# - ç«¯å£ 3000 è¢«å ç”¨ï¼šæ”¹ä¸ºå…¶ä»–ç«¯å£
# - ç¯å¢ƒå˜é‡é”™è¯¯ï¼šæ£€æŸ¥ .env.production
# - æ•°æ®åº“è¿æ¥å¤±è´¥ï¼šæ£€æŸ¥ DATABASE_URL
```

### 2. æ— æ³•è®¿é—®ç½‘ç«™

```bash
# æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
docker ps

# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep 3000

# æ£€æŸ¥é˜²ç«å¢™
# å®å¡”é¢æ¿ â†’ å®‰å…¨ â†’ æ”¾è¡Œç«¯å£ 3000ï¼ˆä»…æµ‹è¯•ï¼‰

# æ£€æŸ¥ Nginx é…ç½®
nginx -t
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker exec -it deepseek-c sh
node -e "const { PrismaClient } = require('@prisma/client'); new PrismaClient().\$connect().then(() => console.log('OK')).catch(e => console.error(e))"

# æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
# å®å¡”é¢æ¿ â†’ è½¯ä»¶å•†åº— â†’ PostgreSQL â†’ çŠ¶æ€
```

### 4. æ„å»ºå¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜é‡æ–°æ„å»º
docker builder prune -af
docker build -t deepseek-c . --no-cache
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. âœ… **ä¿®æ”¹å®å¡”é»˜è®¤ç«¯å£**ï¼ˆ8888 â†’ è‡ªå®šä¹‰ï¼‰
2. âœ… **å¯ç”¨å®å¡”é¢æ¿ SSL**
3. âœ… **å®šæœŸæ›´æ–°ç³»ç»Ÿ** `yum update` æˆ– `apt update && apt upgrade`
4. âœ… **ä½¿ç”¨å¼ºå¯†ç **ï¼ˆæ•°æ®åº“ã€å®å¡”é¢æ¿ï¼‰
5. âœ… **é…ç½®é˜²ç«å¢™**åªå¼€æ”¾ 80ã€443ã€SSH ç«¯å£
6. âœ… **å®šæœŸå¤‡ä»½æ•°æ®åº“**
7. âœ… **ä¸è¦æ³„éœ² `.env.production` æ–‡ä»¶**
8. âœ… **é‡æ–°ç”Ÿæˆ `NEXTAUTH_SECRET`** `openssl rand -base64 32`

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. Nginx ç¼“å­˜

åœ¨ Nginx é…ç½®ä¸­æ·»åŠ ï¼š

```nginx
# é™æ€èµ„æºç¼“å­˜
location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg)$ {
    proxy_pass http://127.0.0.1:3000;
    expires 7d;
    add_header Cache-Control "public, immutable";
}
```

### 2. æ•°æ®åº“ä¼˜åŒ–

```bash
# è¿›å…¥ PostgreSQL
sudo -u postgres psql deepseek-c

# åˆ›å»ºç´¢å¼•
CREATE INDEX idx_conversation_user ON "Conversation"("userId");
CREATE INDEX idx_message_conversation ON "Message"("conversationId");
```

### 3. Docker èµ„æºé™åˆ¶

```yaml
# docker-compose.yml
services:
  deepseek-c:
    # ... å…¶ä»–é…ç½®
    deploy:
      resources:
        limits:
          cpus: "1"
          memory: 1G
        reservations:
          memory: 512M
```

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„ DeepSeek-C åº”ç”¨å·²ç»æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒäº†ï¼

è®¿é—®ï¼š`https://your-domain.com` å¼€å§‹ä½¿ç”¨å§ï¼

---

## ğŸ“ è·å–å¸®åŠ©

- æŸ¥çœ‹æ—¥å¿—ï¼š`docker logs -f deepseek-c`
- GitHub Issues: https://github.com/sujiu222/deepseek-c/issues
- å®å¡”è®ºå›ï¼šhttps://www.bt.cn/bbs/
